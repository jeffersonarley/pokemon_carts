<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokÃ©dex API - Estilo NeÃ³n</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body class="video-background-body"> 
    
<video autoplay muted loop id="background-video">
    <source src="video/hilda-and-tepig-watching-castelia-city-pokemon-pixel-moewalls-com.mp4" type="video/mp4"> 
</video>

    <div class="pokedex-container"> <div class="pokedex-border-glow"> <div class="pokedex-card">
                <div class="card-corner top-left"></div>
                <div class="card-corner top-right"></div>
                <div class="card-corner bottom-left"></div> 
                <div class="card-corner bottom-right"></div>

                <div class="search-and-header">
                    <div class="pokedex-title"> POKÃ‰DEX-CARD</div>
                    <div class="search-container">
                        <input id="pok" type="text" placeholder="Escribe nombre o nÃºmero de PokÃ©mon...">
                        <button onclick="traer()">Buscar</button>
                    </div>

                    <header class="card-header">
                        <div class="poke-ball-design">
                            <img id="img" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Imagen del PokÃ©mon" class="pokemon-image-display">
                        </div>
                        <div class="number-and-name-display">
                            <span id="numero" class="pokemon-number-display">#???</span>
                            <h1 id="nombre">Buscar un PokÃ©mon</h1>
                        </div>
                    </header>
                </div>

                <div class="main-info-grid">
                    <section class="section identity">
                        <h3 class="section-title">IDENTITY</h3>
                        <div class="identity-content">
                            <div><span>Name:</span><span id="name-api">N/A</span></div>
                            <div><span>Pokedex No.:</span><span id="number-api">N/A</span></div>
                            <div><span>Height:</span><span id="height-api">N/A</span></div>
                            <div><span>Weight:</span><span id="weight-api">N/A</span></div>
                        </div>
                    </section>

                    <section class="section elemental-class">
                        <h3 class="section-title">ELEMENTAL CLASS</h3>
                        <div class="elemental-content">
                            <div><span>Type 1:</span><span id="type1-api" class="type">N/A</span></div>
                            <div><span>Type 2:</span><span id="type2-api" class="type">N/A</span></div>
                            <div><span>Types:</span><span id="types-api">N/A</span></div>
                        </div>
                    </section>
                </div>

                <div class="stats-and-advanced-grid">
                    <section class="section stats">
                        <h3 class="section-title">STATS</h3>
                        <ul class="stats-list">
                            <li><div class="stat-name">HP</div><div class="stat-bar-wrapper"><span id="stat-hp" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-hp" class="stat-bar"></div></div></div></li>
                            <li><div class="stat-name">Attack</div><div class="stat-bar-wrapper"><span id="stat-attack" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-attack" class="stat-bar"></div></div></div></li>
                            <li><div class="stat-name">Defense</div><div class="stat-bar-wrapper"><span id="stat-defense" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-defense" class="stat-bar"></div></div></div></li>
                            <li><div class="stat-name">Sp. Attack</div><div class="stat-bar-wrapper"><span id="stat-sp-attack" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-sp-attack" class="stat-bar"></div></div></div></li>
                            <li><div class="stat-name">Sp. Defense</div><div class="stat-bar-wrapper"><span id="stat-sp-defense" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-sp-defense" class="stat-bar"></div></div></div></li>
                            <li><div class="stat-name">Speed</div><div class="stat-bar-wrapper"><span id="stat-speed" class="stat-value">N/A</span><div class="stat-bar-container"><div id="bar-speed" class="stat-bar"></div></div></div></li>
                        </ul>
                    </section>

                    <section class="section advanced-details">
                        <h3 class="section-title">WEAKNESSES (X2 / X4)</h3>
                        <div class="weaknesses-container" id="weaknesses-api">
                            <span class="placeholder-text">N/A</span>
                        </div>
                    </section>
                </div>

            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        
        // =======================================================
        // ðŸ› ï¸ MAPA DE COLORES PARA EL FONDO DINÃMICO DE LA POKEBALL
        // =======================================================
        const typeColors = {
            normal: '#A8A878', fire: '#FD7D24', water: '#4592C4', grass: '#9BCC50', 
            electric: '#F7D02C', ice: '#98D8D8', fighting: '#C03028', poison: '#A33EA1', 
            ground: '#E0C068', flying: '#A890F0', psychic: '#F85888', bug: '#A8B820', 
            rock: '#B8A038', ghost: '#705898', dragon: '#7038F8', dark: '#705848', 
            steel: '#B8B8D0', fairy: '#EE99AC'
        };

        // FunciÃ³n auxiliar para obtener y consolidar las debilidades
        async function getWeaknesses(types) {
            const damageMultipliers = {};
            for (const typeInfo of types) {
                const typeName = typeInfo.type.name;
                
                try {
                    const typeRes = await axios.get(`https://pokeapi.co/api/v2/type/${typeName}`);
                    const damageRelations = typeRes.data.damage_relations;

                    damageRelations.double_damage_from.forEach(relation => {
                        const incomingType = relation.name;
                        damageMultipliers[incomingType] = (damageMultipliers[incomingType] || 1) * 2; 
                    });

                    damageRelations.half_damage_from.forEach(relation => {
                        const incomingType = relation.name;
                        damageMultipliers[incomingType] = (damageMultipliers[incomingType] || 1) * 0.5;
                    });

                    damageRelations.no_damage_from.forEach(relation => {
                        const incomingType = relation.name;
                        damageMultipliers[incomingType] = 0;
                    });
                } catch (e) {
                    console.error(`Error al obtener datos para el tipo: ${typeName}`, e);
                }
            }

            const weaknesses = Object.entries(damageMultipliers)
                .filter(([type, multiplier]) => multiplier >= 2)
                .map(([type, multiplier]) => ({ type: type.toUpperCase(), multiplier }));

            return weaknesses;
        }

        // FunciÃ³n auxiliar para limpiar clases CSS de tipo (ej: "type-fire")
        function cleanTypeClasses(element) {
            const classes = element.className.split(' ');
            const typeClasses = classes.filter(cls => !cls.startsWith('type-'));
            element.className = typeClasses.join(' ');
        }


        async function traer() {
            let pokemonInput = document.getElementById("pok").value.toLowerCase(); 
            const weaknessesContainer = document.getElementById("weaknesses-api");
            const pokeBallElement = document.querySelector('.poke-ball-design');
            
            try {
                // Limpiar clases y estilos antes de la carga
                cleanTypeClasses(document.getElementById("type1-api"));
                cleanTypeClasses(document.getElementById("type2-api"));
                weaknessesContainer.innerHTML = '<span class="placeholder-text">Cargando...</span>';
                pokeBallElement.style.background = 'none'; // Limpia el fondo anterior

                let res = await axios.get(`https://pokeapi.co/api/v2/pokemon/${pokemonInput}`);
                const data = res.data;
                
                // =======================================================
                // 1. LÃ³gica del Fondo DinÃ¡mico de la Pokeball (CON DESVANECIDO)
                // =======================================================
                const typeNames = data.types.map(typeInfo => typeInfo.type.name.toLowerCase());
                let backgroundStyle = '';

                if (typeNames.length === 1) {
                    // Un tipo: color sÃ³lido
                    const color = typeColors[typeNames[0]];
                    backgroundStyle = color; 
                } else if (typeNames.length >= 2) {
                    // Dos o mÃ¡s tipos: degradado SUAVE (zona de desvanecido del 40% al 60%)
                    const color1 = typeColors[typeNames[0]];
                    const color2 = typeColors[typeNames[1]];
                    
                    backgroundStyle = `linear-gradient(to bottom, ${color1} 0%, ${color1} 40%, ${color2} 60%, ${color2} 100%)`;
                }
                
                pokeBallElement.style.background = backgroundStyle;
                pokeBallElement.style.border = `5px solid var(--primary-blue)`; // Re-aplicar el borde neÃ³n
                
                
                // =======================================================
                // 2. ActualizaciÃ³n de Identidad, Tipos y Encabezado
                // =======================================================
                document.getElementById("nombre").textContent = data.name.toUpperCase();
                document.getElementById("numero").textContent = `#${data.id.toString().padStart(3, '0')}`;

                const pokemonImage = document.getElementById("img");
                pokemonImage.src = data.sprites.other["official-artwork"]["front_default"]; 
                pokemonImage.style.display = "block"; 

                document.getElementById("name-api").textContent = data.name.toUpperCase();
                document.getElementById("number-api").textContent = `#${data.id}`;
                document.getElementById("height-api").textContent = `${(data.height / 10).toFixed(1)} m`;
                document.getElementById("weight-api").textContent = `${(data.weight / 10).toFixed(1)} kg`;

                // Tipos (separados por /)
                const typesList = typeNames.map(name => name.toUpperCase()).join(" / ");
                document.getElementById("types-api").textContent = typesList;

                // Aplicar color al Type 1
                const type1Element = document.getElementById("type1-api");
                type1Element.textContent = typeNames[0].toUpperCase();
                type1Element.classList.add(`type-${typeNames[0]}`); 
                
                // Aplicar color al Type 2
                const type2Element = document.getElementById("type2-api");
                if (data.types.length > 1) {
                    type2Element.textContent = typeNames[1].toUpperCase();
                    type2Element.classList.add(`type-${typeNames[1]}`); 
                } else {
                    type2Element.textContent = "N/A";
                    cleanTypeClasses(type2Element); 
                }
                
                // =======================================================
                // 3. ActualizaciÃ³n de EstadÃ­sticas Base con Barras
                // =======================================================
                const stats = data.stats;
                const maxStatValue = 255; 

                const statMap = [
                    { id: "hp", value: stats[0].base_stat },
                    { id: "attack", value: stats[1].base_stat },
                    { id: "defense", value: stats[2].base_stat },
                    { id: "sp-attack", value: stats[3].base_stat },
                    { id: "sp-defense", value: stats[4].base_stat },
                    { id: "speed", value: stats[5].base_stat }
                ];

                statMap.forEach(stat => {
                    const percentage = (stat.value / maxStatValue) * 100;
                    document.getElementById(`stat-${stat.id}`).textContent = stat.value;
                    document.getElementById(`bar-${stat.id}`).style.width = `${percentage}%`;
                });
                
                // =======================================================
                // 4. Calcular y mostrar Debilidades
                // =======================================================
                const weaknesses = await getWeaknesses(data.types);

                weaknessesContainer.innerHTML = ''; 
                
                if (weaknesses.length === 0) {
                    weaknessesContainer.innerHTML = '<span class="placeholder-text">Â¡Sin Debilidades X2 o X4!</span>';
                } else {
                    weaknesses.forEach(weakness => {
                        const tag = document.createElement('span');
                        tag.classList.add('type-tag');
                        tag.textContent = `${weakness.type} x${weakness.multiplier}`; 
                        tag.classList.add(`type-${weakness.type.toLowerCase()}`); 
                        weaknessesContainer.appendChild(tag);
                    });
                }


            } catch (error) {
                console.error("Error al buscar el PokÃ©mon:", error);
                
                // Reset de todos los elementos en caso de error
                document.getElementById("nombre").textContent = "Â¡PokÃ©mon No Encontrado!";
                document.getElementById("numero").textContent = "#???";
                document.getElementById("img").src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="; 
                
                pokeBallElement.style.background = 'none';
                
                const elementsToReset = [
                    "name-api", "number-api", "height-api", "weight-api", "types-api",
                    "stat-hp", "stat-attack", "stat-defense", "stat-sp-attack", "stat-sp-defense", "stat-speed"
                ];
                elementsToReset.forEach(id => {
                    document.getElementById(id).textContent = "N/A";
                });
                
                cleanTypeClasses(document.getElementById("type1-api"));
                cleanTypeClasses(document.getElementById("type2-api"));
                document.getElementById("type1-api").textContent = "N/A";
                document.getElementById("type2-api").textContent = "N/A";
                

                const barElementsToReset = [
                    "bar-hp", "bar-attack", "bar-defense", "bar-sp-attack", "bar-sp-defense", "bar-speed"
                ];
                barElementsToReset.forEach(id => {
                    document.getElementById(id).style.width = "0%";
                });

                weaknessesContainer.innerHTML = '<span class="placeholder-text">N/A</span>';
            }
        }
    </script>
</body>
</html>